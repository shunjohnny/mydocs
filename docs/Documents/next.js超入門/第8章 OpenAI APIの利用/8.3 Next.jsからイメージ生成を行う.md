---
title: 8.3 Next.jsからイメージ生成を行う
tags:
  - Next.js
---

OpenAIのapiを使用してプロンプトに対して画像生成するコンポーネントを作成する

```typescript title="src/app/pages.tsx"
"use client"
import { useState } from 'react'

const url = 'https://api.openai.com/v1/images/generations'
const api_key = 'APIキーをここに入力してください'

export default function Home() {
  const [input, setInput] = useState('')
  const [prompt, setPrompt] = useState('')
  const [src, setSrc] = useState('/noimage.png')

  const doChange = (event)=> {
    setInput(event.target.value)
  }

  const doAction = ()=> {
    const opts = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + api_key
      },
      body: JSON.stringify({
        "prompt": input,
        "n": 1,
        "size": "256x256"
      })
    }
    fetch(url, opts)
      .then(response => response.json())
      .then(data => {
        setPrompt(input)
        setInput('')
        setSrc(data.data[0].url);
      })
  }

  return (
    <main>
      <h1 className="title">Index page</h1>
      <p className="msg font-bold">プロンプトを入力 : </p>
      <div className="mx-5">
        <input type="text" className="input" value={input} onChange={doChange}/>
        <button className="btn" onClick={doAction}>Send</button>
      </div>
      <div className="prompt">
        <div>PROMPT: {prompt}</div>
        <div>
          <a href={src} target="_blank">
            <img className="my-0" width="256" height="256" src={src} />
          </a>
        </div>
      </div>
    </main>
  )
}
```