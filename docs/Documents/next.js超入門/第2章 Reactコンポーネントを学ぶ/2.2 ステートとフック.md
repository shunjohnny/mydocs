---
title: 2.2 ステートとフック
tags:
  - Next.js
---

## ステートで値を保持する

ブラウザ上でクリックすることでカウントが増えるプログラムを作成する  

その前にクリックする箇所を装飾するためのcssを追記しておく
```css title="/src/App.css"
.clickable {
    cursor: pointer;
    font-size: 24px;
}
```

下記のようにApp.jsを変更するだけでは、カウントされない  
→関数コンポーネントが呼び出されたときだけ動き、描写が終わると消えるため発生  
→→コンポーネントの状態等の値を保持するステートを使用する必要あり

```typescript title="/src/App.js クリックしてもカウントが増えないプログラム"
import './App.css'

function App(props) {
  var counter = 0
  const doClick = () => {
    counter++
  }

  return (
    <div className="App">
      <h1 className={props.color}>{props.title}</h1>
      <p className={`${props.color} clickable`}
        onClick={doClick}>counter: {counter}.</p>
    </div>
  )
}

export default App
```

<br>

## ステートフックという考え方

|ステート|ステートフック|フック|
|---|---|---|
|コンポーネントの状態を表す<br>データ|関数コンポーネントで<br>ステートを利用するための<br>Reactフック|Reactで関数コンポーネントに<br>様々な機能を追加する仕組み全体を指す<br>概念|

### カウンタを修正する

下記の様に変更を加えるとカウントできるようになる

```typescript title="/src/App.js クリックするとカウントするプログラム"
import './App.css'
import { useState } from 'react'

function App(props) {
  const [counter, setCounter] = useState(0)
  const doClick = () => {
    setCounter(counter + 1)
  }

  return (
    <div className="App">
      <h1 className={props.color}>{props.title}</h1>
      <p className={`${props.color} clickable`}
        onClick={doClick}>counter: {counter}.</p>
    </div>
  )
}

export default App
```
<figure markdown="span">
  ![alt text](<../../../images/2.2 ステートとフック/2.2 ステートとフック_J0133291.png>){width="200"}
  <figconfig>クリックできるようになった状態</figconfig>
</figure>

### ステートフックの使い方

上記のプログラムを確認しながらステートフックについて解説する
下記のようにしてステートフックを設定する

```typescript title="ステートフックの設定"
const [counter, setCounter] = useState(0)
```
```typescript
const [変数A, 変数B] = useState(初期値)
```



|変数A|変数B|useState(初期値)|
|-------|----------|----------|
|ステートの値を保管する変数|ステートの値を変更する関数|変数と関数を初期値で作成|
  
定義したsetCounterを使用することで、  
doClick関数が呼び足される度に、  
counterに入っている値 + 1がcounterに新たに入って保持される。

```typescript title="ステートの値を変更する関数"
const doClick = () => {
  setCounter(counter + 1)
}
```

!!! warning
    イベントの属性に関数を割り当てる場合は、onClick={doClick}のように関数を{}で囲って使用する。<br>onClick={doClick()}とかは不可

!!! tips
    イベント属性：onClick,onChange,onSubmitなど小文字のonの後に大文字で始まるもの。<br>ユーザーの操作に応じて動的に動作を制御

<br>

## フォームを使う

|フォーム|
|---|
|ユーザーの入力内容をReactの状態やDOMで管理して処理するための仕組み|

要するにユーザー入力のときに使用するもの
これを使用してみる

その前に入力する箇所を装飾するためのcssを追記しておく
```css title="/src/App.css"
input {
  margin:5px;
  padding:5px;
}

button {
  margin:5px;
  padding: 5px 15px;
}
```

```typescript title="/src/App.js 文字を入れてクリックすると画面に反映されるプログラム"
import './App.css'
import {useState} from 'react'

function App(props) {
  const [input, setInput] = useState("")
  const [message, setMessage] = useState("お名前は？")
  const doInput = (event) => {
    setInput(event.target.value)
  }

  const doClick = ()=> {
    setMessage("こんにちは、"+ input + "さん!")
  }
    
  return (
    <div className="App">
      <h1 className={props.color}>{props.title}</h1>
      <p className={`${props.color} clickable`}>{message}</p>
      <div>
        <input type="text" onChange={doInput}/>
        <button onClick={doClick}>Click</button>
      </div>
    </div>
  )
}

export default App
```
<figure markdown="span">
  ![alt text](<../../../images/2.2 ステートとフック/2.2 ステートとフック_J0133291-1.png>){width="300"}
  <figconfig>文字を入力してクリックした後の状態</figconfig>
</figure>

<br>

## 副作用フックについて

|副作用フック|
|---|
|コンポーネントの更新時に自動的に処理を実行させるためのもの|

```typescript title="useEffectの使用方法"
useEffect(関数, [ステート])
```
useEffectを使用すると、コンポーネントが更新された際に自動的に処理が実行される。  

下記のプログラムだと、  
setInputでinputステートに値が入ると、  
useEffectの関数が実行され、setMessageでmessageステートに値が入る。

!!! notes
    第一引数(useStateの関数)は、通常アロー関数を使用して定義する

```typescript title="/src/App.js 入力した数字が素数かどうか確認するプログラム"
import './App.css'
import {useState, useEffect} from 'react'

function App(props) {
  const[input, setInput] = useState(1)
  const[message, setMessage] = useState("整数を入力:")
  const doInput = (event) => {
    setInput(event.target.value)
  }

  //useEffectで素数をチェック
  useEffect(()=>{
    var prime = true
    if (input === 1) {
      prime = false
    } else {
      for (var i =2;i <= input/2;i++) {
        if(input % i === 0){
          prime = false
          break
        }
      }
    }
    setMessage(prime ? "素数です。":"素数ではない。")
  },[input])

  return (
    <div className="App">
      <h1 className={props.color}>{props.title}</h1>
      <p className={`${props.color}, clickable`}>{message}</p>
      <div>
        <input type="number" min = "1" onChange={doInput} />
      </div>
    </div>
  )
}

export default App
```

<figure markdown="span">
  ![alt text](<../../../images/2.2 ステートとフック/2.2 ステートとフック_J0133291-2.png>){width="300"}
  <figconfig>文字を入力してクリックした後の状態</figconfig>
</figure>