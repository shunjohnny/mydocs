---
title: 5.2 PagesルーターとStatic Site Generation
tags:
  - Next.js
---

## SSG(Static Site Generation)について
---
|SSG|
|---|  
|ビルド時に事前にHTMLコードに変換し、完全に静的なWebアプリケーションとして生成する|


Pagesルーターのプロジェクトを使用して作業しながら解説する。  
前章で使用していたものを続いて使用する。  
_layout.tsxを変更して、_layout.tsxを使用しないようにする。  

```typescript title="_layout.tsx"
import "@/styles/globals.css";
import type { AppProps } from "next/app";

export default function App({ Component, pageProps }: AppProps) {
    console.log(pageProps)
    return <Component {...pageProps} />
}
```

<br>

pagesフォルダーのindex.tsxを開いて完全に静的なページを作成
```typescript title="index.tsx"
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin']})

export default function Home() {
  return (
    <main>
      <h1 className="header">Static page</h1>
      <p>これは、静的ページです。ビルド時にレンダリングされています。</p>
    </main>
  )
}
```

<figure markdown="span">
  ![Image title](<../../../images/5.2 PagesルーターとStatic Site Generation/5.2 PagesルーターとStatic Site Generation_J0133291.png>){ width="500" }
  <figcaption>実行結果</figcaption>
</figure>

<br>

## 静的プロパティの利用
---

### getStaticProps関数について

完全に静的なページ：リテラル(元から用意されているもの)に用意されている  
→もしページ内に**動的に変化する値**が必要なら、毎回手動で更新するのは面倒  
→→`getStaticProps`を使うと、**静的ページで使う値をビルド時に準備**できる  
→→→アプリケーションがビルドされる際にその値が**キャッシュ**され、**静的にレンダリング**

### getStaticPropsの使い方

静的プロパティを作成するには以下の二つの方法がある
```Typescript
export function getStaticProps({params}) {
  ---処理---
  return 値
}
```

```Typescript
export const getStaticProps = ((引数) => {return 値})

```

<br>

上記のreturnで渡された値は下記のような形でコンポーネントが受け取る
```Typescript
export default function 名前({ children, プロパティ名}) {.....}
```

### 戻り値の扱い
returnで適当に値を返してもコンポーネント側でうまく利用できないため、
きちんと受け渡せるように構造として戻り値を用意する必要がある。

下記のように「戻り値のpropsプロパティ」として返す必要がある
```Typescript
{
  props: {
    キー:値,
    キー:値,
    ...略...
  }
}
```

### まとめ
「getStaticPropsで返される値」と「コンポーネントの引数」の関係はこうなる

```Typescript title="getStaticPropsから返す値"
export function getStaticProps({params}){
  return { props:{a:値, b:値, c:値}}
}
```

```Typescript title="コンポーネントで受け取る値"
export default function 名前({ children, 引数a, 引数b, 引数c}) {
  ...引数.a,引数.b,引数.cを利用する...
}
```

<br>

## 静的プロパティを利用する
---

pagesのother.tsxを編集して実際の動きを確認  
getStaticPropsで用意された静的なデータを  
Otherコンポーネントが受け取って利用していることが分かる

```Typescript title="other.tsx"
import { Inter } from 'next/font/google'
import Link from 'next/link'

const inter = Inter({ subsets: ['latin']})

//ページのコンポーネント定義
export default function Other({ data }) {
    return (
        <main>
            <h1 className="header">{data.title}</h1>
            <p>{data.msg}</p>
            <div><Link href="/">Go Back!!</Link></div>
        </main>
    )
}

//getStaticPropsで静的なデータを準備
export function getStaticProps({ params }) {
    const data = {
        title:'Other page',
        msg:'これは静的プロパティのサンプルです。'
    }
    return {
        props: {
            data:data
        }
    }
}
```
<br>

## ダイナミックルーティングのSSG
---

ダイナミックルーティングを使用すると、URLの一部をパラメータとして受け取れる  
パラメータが限られた値の場合、静的ページとしても作成可能  

### getStaticPaths関数について

getStaticPathsを使用して、アクセスされるパスの配列を返す
```Typescript title="getStaticPaths関数"
export function getStaticPatchs() {
  return {
    paths:パスの配列、
    fallback: 《boolean》
  }
}
```

### getStaticProps

getStaticPathsで指定されたパスにアクセスすると、  
ダイナミックルーティングのパラメーターがgetStaticPropsの引数として渡る  
このパラメーターを使用し、特定のプロパティを準備し、ページを静的に生成

```Typescript title="getStaticProps関数で処理"
export function getStaticProps() {
  return {
    paths:パスの配列、
    fallback: 《boolean》
  }
}
```

<br>

## [name].tsxを静的ページにする
---


pages/name/[name].tsxを下記のように編集


```Typescript title="静的ページの[name.tsx]"
import { Inter } from 'next/font/google'
import Link from 'next/link'
import { useRouter } from 'next/router'

const inter = Inter({ subsets: ['latin']})

//ページコンポーネントの定義
export default function Name({ data }) {
    const router = useRouter()
    return (
        <main>
            <h1 className="header">{data.title}</h1>
            <p>name: {router.query.name}</p>
            <p>message: {data.msg}</p>
            <div><Link href="/">Go Back!!</Link></div>
        </main>
    )
}

//getStaticPathsで動的パスを取得する
export function getStaticPaths() {
    const path = [
        '/name/taro',
        '/name/hanako',
        '/name/sachiko',
    ]
    return {
        paths: path,
        fallback: false
    }
}

//getStaticPropsでページごとのデータを準備する
export function getStaticProps({ params }) {
    const data = {
        taro:{
            title:'Taro-web',
            msg:"This is Taro's web site."
        },
        hanako:{
            title:'ハナコの部屋',
            msg:'ここは、ハナコの部屋です。'
        },
        sachiko:{
            title:'サチコのページ',
            msg:'ヤッホー、サチコのページだよー！'
        }
    }

    return {
        props:{
            data:data[params.name]
        }
    }
}
```

<figure markdown="span">
  ![Image title](<../../../images/5.2 PagesルーターとStatic Site Generation/5.2 PagesルーターとStatic Site Generation_J0133291-1.png>){ width="300" }
  <figcaption>実行結果</figcaption>
</figure>