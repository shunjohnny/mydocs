---
title: 5.4 Appルーターにおけるレンダリング
tags:
  - Next.js
---

## レンダリングとコンポーネント
---
Appルーターは、Pagesルーターと仕組みが異なり、  
ページ生成に関連するモジュールは下記の様に分かれており、  
コンポーネントも同様に分かれる

|サーバーサイドモジュール|クライアントモジュールグラフ|
|---|---|
|サーバー側で動くもの|クライアント側で動くもの|

### レンダリングの明示的な指定

下記の指定を記載することで、  
「このコンポーネントはどちらでレンダリングされて動くか」を明示し、  
それに応じたコードが記述できるようにする

| 指定           | 説明                           |
|----------------|--------------------------------|
| "use client" | クライアントコンポーネントにする |
| "use server" | サーバーコンポーネントにする     |

### sample_next_appの準備

以下ではAppルーターのプロジェクトを使用しての説明です  
sample_next_appフォルダを開いてください

<br>

## 静的ページについて
---

完全に静的なページとして生成される例を確認する

```css title="globals.cssに追記"
h1.title {
  @apply text-2xl font-bold m-0 p-5 text-white bg-blue-800 text-center;
}

p.msg {
  @apply text-lg m-5 text-gray-900;
}
```

```Typescript title="page.tsx"
//サーバーモードの指定
"use server"
import { Metadata } from 'next'

//Metadateの用意
export async function generateMetadata(){
    return {
        title: 'Index page',
    }
}

//デフォルトプロパティの用意
const defalutProps = {
    title:"Static page",
    msg:"This is static page sample."
}

//ページコンポーネントの定義
export default async function Home() {
    return (
        <main>
            <h1 className="title">{defalutProps.title}</h1>
            <p className="msg">{defalutProps.msg}</p>
        </main>
    )
}
```

<figure markdown="span">
  ![Image title](<../../../images/5.4 Appルーターにおけるレンダリング/5.4 Appルーターにおけるレンダリング_J0133291.png>){ width="400" }
  <figcaption>実行結果</figcaption>
</figure>

!!! warning
    サーバーコンポーネントを作成する時、関数は全て非同期(async)で定義する

<br>

## ダイナミックレンダリングのページ
---

サーバーコンポーネントは動的レンダリングも可能だが、  
特定のパスのみ静的に生成する場合はgenerateStaticParamsでパスを指定する。 

```Typescript title="静的ページへのパスを返す関数"
export async function generateStaticParams() {
    return パスの配列
}
```

### 特定ページへのアクセスを静的ページ化する

name/[name]/page.tsxファイルを編集し、  
利用例を確認する。

```Typescript title="name/[name]/page.tsx"
"use server"

const paths = [
    { name: 'taro' },
    { name: 'hanako' },
    { name: 'sachiko' }
]

export async function generateStaticParams() {
    return paths
}

export default async function Name({ params }) {
    const result = paths.some(path => path.name === params.name)

    return (
        <main>
            {result ?
            <>
              <h1 className="title">Name = &quot;{params.name}&quot;</h1>
              <p className="msg">{params.name}さん、こんにちわ！</p>
            </>
            :
            <>
                <h1 className="title">Name = &quot;{params.name}&quot;</h1>
                <p className="msg">「{params.name}」は使えません</p>
            </>
            }
            <div>
                <a href="/">go back!!</a>
            </div>
        </main>
    )
}
```

|登録されたname|登録されていないname|
|---|---|
|![alt text](<../../../images/5.4 Appルーターにおけるレンダリング/5.4 Appルーターにおけるレンダリング_J0133291-1.png>)|![alt text](<../../../images/5.4 Appルーターにおけるレンダリング/5.4 Appルーターにおけるレンダリング_J0133291-2.png>)|

<br>

## クライアントコンポーネントについて
---

サーバーで動作しない機能を使用する場合、  
コンポーネントは自動的にクライアントコンポーネントとして扱われる。  
具体的には以下の機能がある。

```Typescript title="useState:Reactの状態管理フック"
import { useState } from 'react'
```

```Typescript title="useRouter:Next.jsでルーティング情報を取得し、ページ状態を管理"
import { useState } from 'next/navigation'
```


```Typescript title="useSearchParams:クエリパラメータの情報を取得するための機能"
import { useStateParams } from 'next/navigation'
```

これらを使用すると、クライアント側でのみ動作するコンポーネントになる。

<br>

## クエリーパラメーターを利用する
---

useSearchParamsは、URLのクエリパラメーターを取得するための関数  
例えば、/hoge?abc=100&xyz=200 のように?以降に続くパラメーターをキーと値のペアで扱う。  
useSearchParams()を使うと、クエリパラメーターのオブジェクトが取得でき、  
getメソッドで特定の値を取り出せる。  

### クエリーパラメーターを利用する。

```css title="globals.cssに追記する"
ul, ol {
  @apply text-xl m-5 font-bold list-disc;
}

li {
  @apply mx-10 font-normal text-blue-700;
}
```

```Typescript title="appフォルダのpage.tsx"
"use client"
import { useSearchParams } from 'next/navigation'

//ページコンポーネントの定義
export default async function Home() {
  const searchParams = useSearchParams()
  return (
    <main>
      <h1 className="title">Index page</h1>
      <ul>※パラメーター
        <li>ID: {searchParams.get('id')}</li>
        <li>PASS: {searchParams.get('pass')}</li>
      </ul>
    </main>
  )
}
```

<figure markdown="span">
  ![Image title](<../../../images/5.4 Appルーターにおけるレンダリング/5.4 Appルーターにおけるレンダリング_J0133291-3.png>){ width="400" }
  <figcaption>http://localhost:3000/?id=◯&pass=〇という形でアクセスすると、それらのパラメータが表示</figcaption>
</figure>