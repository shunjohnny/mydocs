---
title: 4.2 リクエスト処理(クエリパラメータ)
tags:
  - FastAPI
---

## 4-2-1 クエリパラメータの基本

|クエリパラメータ|
|---|
|WebAPIにおけるリクエストの処理<br>URLの一部として「キーと値のペア」で情報を送信する方法<br>?の後に配置され、「検索、フィルタリング、ソート等」を行うために使用|

下記の例では、URLに「/books/?category=technical」というリクエストで関数を呼び出すと、  
「technical」カテゴリの書籍のみを取得

```python title="クエリパラメータの使用例"
@app.get("/books/")
async def get_book_by_category(category: Optional[str]=None):
```

<br>

## 4-2-2 FastAPIプログラム(クエリパラメータ)の作成

```python title="data.py　category情報に対応する本の情報を返す"
from typing import Optional

class Book:
    def __init__(self, id: str, title: str, category: str):
        self.id = id
        self.title = title
        self.category = category
    
books =  [
    Book(id="1", title="Python入門", category="technical"),
    Book(id="2", title="初めてのプログラミング", category="technical"),
    Book(id="3", title="進撃の巨人", category="comics"),
    Book(id="4", title="ドラゴンボール", category="comics"),
    Book(id="5", title="週刊文春", category="magazine"),
    Book(id="6", title="autosports", category="magazine"),
]

def get_books_by_category(category: Optional[str] = None) -> list[Book]:
    if category is None:
        return books
    else:
        return [book for book in books if book.category == category]
```

```python title="main.py　入力カテゴリに対して一致する本の情報を返すAPI"
from fastapi import FastAPI
from typing import Optional
from data import get_books_by_category

app = FastAPI()

@app.get("/books/")
async def read_books(category: Optional[str] = None) -> list[dict[str, str]]:
    result = get_books_by_category(category)
    return [{
        "id": book.id,
        "title": book.title,
        "category": book.category
        } for book in result]
```

## 4-2-3 Swagger UIでの操作

Swagger UIを起動して、  
comicsを入力してexcuteすると、下記のようにcomicsのカテゴリーに該当するものが返される  

![alt text](<../../../images/4.2 リクエスト処理(クエリパラメータ)/4.2 リクエスト処理(クエリパラメータ)_J0133291.png>)