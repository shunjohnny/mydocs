---
title: 10.2 作成アプリケーションの概要
tags:
  - FastAPI
---

## 10-2-1 スキーマ駆動開発でのステップ

![alt text](<../../../images/10.2 作成アプリケーションの概要/10.2 作成アプリケーションの概要_J0133291.png>)

## 10-2-2 自動ドキュメントの作成

### プロジェクトフォルダとファイルの作成

<div style="display: grid; grid-template-columns: 2.5fr 6.5fr; gap: 1rem; align-items: start;" markdown>
<div class="grid-item" markdown>
<figure markdown="span">
![alt text](<../../../images/10.2 作成アプリケーションの概要/10.2 作成アプリケーションの概要_J0133291-1.png>){width=200}
<figcaption>ファイル構成</figcaption>
</figure></div>

<div class="grid-item" markdown>
| フォルダ名 | 役割と説明 |
|------------|------------|
|cruds|CRUDの関数やクラスを配置|
|frontapp|フロントエンドアプリを配置|
|models|データモデルを定義、ORMライブラリ経由で使用|
|routers|アプリケーションの異なるエンドポイントを<br>定義するファイルを配置|
|schemas|リクエストとレスポンスで使用されるデータの形状を<br>定義するPydanticモデルを配置|
</div>
</div>

### スキーマの作成

下記のように3項目に関してスキーマを作成する

```python title="schemas/memo.py"
from pydantic import BaseModel, Field

# ==================================================
# スキーマ定義
# ==================================================
# 登録・更新で使用するスキーマ
class InsertAndUpdateMemoSchema(BaseModel):
    title: str = Field(...,
            description="メモのタイトルを入力してください。少なくとも1文字以上必要です。",
            example="明日のアジェンダ", min_length=1)
    description: str = Field(default="",
            description="メモの内容についての追加情報。任意で記入できます。",
            example="会議で話すトピック：プロジェクトの進捗状況")

# メモ情報を表すスキーマ
class MemoSchema(InsertAndUpdateMemoSchema):
    memo_id: int = Field(...,
            description="メモを一意に識別するID番号。データベースで自動的に割り当てられます。",
            example=123)

# レスポンスで使用する結果用スキーマ
class ResponseSchema(BaseModel):
    message: str = Field(...,
        description="API操作の結果を説明するメッセージ。",
        example="メモの更新に成功しました。")
```


### main.pyを作成する
main.pyを作成する

```python title="main.py"
from fastapi import FastAPI
from fastapi.responses import JSONResponse
from pydantic import ValidationError
from schemas.memo import InsertAndUpdateMemoSchema, MemoSchema, ResponseSchema

app = FastAPI()

# ==================================================
# メモ用のエンドポイント
# ==================================================

# メモ新規登録
@app.post("/memos", response_model=ResponseSchema)
async def create_memo(memo: InsertAndUpdateMemoSchema):
    print(memo)
    return ResponseSchema(message="メモが正常に登録されました")

# メモ情報全件取得
@app.get("/memos", response_model=list[MemoSchema])
async def get_memos_list():
    return [
        MemoSchema(title="タイトル1", description="詳細1", memo_id=1),
        MemoSchema(title="タイトル2", description="詳細2", memo_id=2),
        MemoSchema(title="タイトル3", description="詳細3", memo_id=3)
    ]

# 特定のメモ情報取得
@app.get("/memos/{memo_id}", response_model=MemoSchema)
async def get_memo_detail(memo_id: int):
    return MemoSchema(title="タイトル1", description="詳細1", memo_id=memo_id)

# 特定のメモを更新する
@app.put("/memos/{memo_id}", response_model=ResponseSchema)
async def modify_memo(memo_id: int, memo: InsertAndUpdateMemoSchema):
    print(memo_id, memo)
    return ResponseSchema(message="メモが正常に更新されました")

# 特定のメモを削除する
@app.delete("/memos/{memo_id}", response_model=ResponseSchema)
async def remove_memo(memo_id: int):
    print(memo_id)
    return ResponseSchema(message="メモが正常に削除されました")

# バリデーションエラーのカスタムハンドラ
@app.exception_handler(ValidationError)
async def validation_exception_handler(exc: ValidationError):
    return JSONResponse(
            status_code=422,
            content={
            "detail": exc.errors(),
            "body": exc.model
        }
    )
```

Swagger UIで確認すると各エンドポイントと対応するスキーマが確認できる

<figure markdown="span">
  ![alt text](<../../../images/10.2 作成アプリケーションの概要/10.2 作成アプリケーションの概要_J0133291-2.png>){width=400}
  <figconfig>実行結果</figconfig>
</figure>