---
title: 9.2 DIを使用したアプリケーションの作成？
tags:
  - FastAPI
---

## 9-2-1 プロジェクトの作成

アクティブなユーザーだけをリストアップするAPIを作成

```python title="main.py　"
from fastapi import FastAPI, Depends
from pydantic import BaseModel

app = FastAPI()

# ユーザーモデルの定義
class User(BaseModel):
   username: str 
   is_active: bool = True

# ユーザーデータのリスト 
users = [
   User(username="太郎", is_active=True),
   User(username="次郎", is_active=False),
   User(username="花子", is_active=True)
]

# アクティブなユーザーをフィルタリングする依存関係
def get_active_users():
   # アクティブなユーザーだけをフィルタリング
   active_users = [user for user in users if user.is_active]
   print('=== アクティブなユーザーを取得 ===')
   return active_users

# ルート操作で依存関係を使用
@app.get("/active")
async def list_active_users(active_users: list[User] = Depends(get_active_users)):
   print('=== [依存]してデータを取得 ===')
   return active_users
```

## 9-2-2 動作確認の実施

Swagger UIで結果を確認
is_active=Trueのものが出力されている

<figure markdown="span">
  ![alt text](<../../../images/9.2 DIを使用したアプリケーションの作成/9.2 DIを使用したアプリケーションの作成_J0133291.png>){width=250}
  <figconfig>実行結果</figconfig>
</figure>