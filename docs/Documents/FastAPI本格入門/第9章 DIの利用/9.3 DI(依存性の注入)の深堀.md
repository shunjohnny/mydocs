---
title: 9.3 DI(依存性の注入)の深堀
tags:
  - FastAPI
---

## 9-3-1 DIを取り巻く用語の整理

|用語|図|説明|
|---|---|---|
|Dependency|![alt text](<../../../images/9.3 DI(依存性の注入)の深堀/9.3 DI(依存性の注入)の深堀_J0133291.png>){width="100"}|プログラムAが別プログラムBの機能を利用<br>AがBに依存|
|Dependency<br> Injection|![alt text](<../../../images/9.3 DI(依存性の注入)の深堀/9.3 DI(依存性の注入)の深堀_J0133291-1.png>){width="190"}|プログラムAが別プログラムBの機能利用のため<br>プログラムBを外部から渡す|
|Dependency<br> Inversion<br> Principle|![alt text](<../../../images/9.3 DI(依存性の注入)の深堀/9.3 DI(依存性の注入)の深堀_J0133291-2.png>){width="220"}|上位レベルのモジュールが<br>下位レベルのモジュールに依存しないようにする<br>SOLID原則の一つ|

### SOLID原則

一言でいうとオブジェクト指向設計の5つの基本原則  
これに従って設計すると良い

| 原則 | 説明 | 例 |
|---------|------|-----|
| 単一責任の原則<br>(Single Responsibility<br>Principle) | 一つのクラスに一つの責任のみを持たせる | ユーザー管理と<br>ファイル管理の機能を<br>別クラスに分離 |
| オープン/クローズドの原則<br>(Open/Closed<br>Principle) | 拡張に対して開き、<br>修正に対して閉じた設計 | 既存コード修正なしで<br>新機能を新クラスとして<br>追加 |
| リスコフの置換原則<br>(Liskov Substitution<br>Principle) | サブクラスは親クラスと互換性を保持 | 動物クラスを継承する<br>犬クラスと猫クラス。<br>両者とも動物としての<br>基本動作を保証 |
| インターフェース分離の原則<br>(Interface Segregation<br>Principle) | 利用しない機能への<br>依存を避けた専用インターフェース設計 | プリンターの印刷機能と<br>スキャン機能を<br>別インターフェースに分離 |
| 依存関係逆転の原則<br>(Dependency Inversion<br>Principle) | 上位モジュールと<br>下位モジュールの両者を<br>抽象に依存させる構造 | データベース直接アクセス<br>を避け、インターフェース<br>を介した実装 |

## 9-3-2 DIの使い所と気をつけること

### 使い所

モックオブジェクトを作成してテストする際に有用

<figure markdown="span">
  ![alt text](<../../../images/9.3 DI(依存性の注入)の深堀/9.3 DI(依存性の注入)の深堀_J0133291-3.png>){width=300}
  <figconfig>モック</figconfig>
</figure>

### 気をつけること
・過剰な適用を避ける  
　│  
　├─ ユーティリティクラスには不要  
　│   └─ シンプルで独立した機能のため  
　│  
　└─ 密結合ロジックには不向き  
　　　├─ 相互依存が強い処理  
　　　└─ 一体として扱った方が簡潔  
  
・必要以上に複雑な依存関係を作らない  
　└─ コードの可読性と保守性を重視  
