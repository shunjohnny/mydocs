---
title: 6.1 同期処理と非同期処理とは？
tags:
  - FastAPI
---

## 6-1-1 同期処理と非同期処理

|同期処理|非同期処理|
|---|---|
|タスクを順番に1つずつ完了させる処理|並行処理|

下記のように非同期処理をするプログラムを作成する

```python title="main.py 同期処理と非同期処理の違いを確認"
import time

# 1.同期処理 普通の処理
def sync_task(name):
    print(f"{name} タスク開始")
    time.sleep(2)
    print(f"{name} タスク終了")

def run_sync_tasks():
    sync_task("タスク1")
    sync_task("タスク2")
    sync_task("タスク3")

print("同期処理の例")
run_sync_tasks()

# 2.非同期処理
import asyncio                      # asyncio, waitを使用して並列処理するためのライブラリ

async def async_task(name):         # async : 関数を非同期にするための宣言
    print(f"{name} タスク開始")      
    await asyncio.sleep(2)          # await : 非同期関数の実行を待つ際に使用
    print(f"{name} タスク終了")

async def run_async_tasks():
    await asyncio.gather(           # asyncio.gather : 色々な非同期タスクを同時にまとめて実行するもの
        async_task("タスクA"),
        async_task("タスクB"),
        async_task("タスクC") 
    )

print("\n非同期処理の例：")
asyncio.run(run_async_tasks())      # asyncio.run : 非同期関数を開始し、完了するまで実行
```

非同期処理の方はタスクの開始が同時に始まっていることが分かる

```bash title="出力結果"
同期処理の例
タスク1 タスク開始
タスク1 タスク終了
タスク2 タスク開始
タスク2 タスク終了
タスク3 タスク開始
タスク3 タスク終了

非同期処理の例：
タスクA タスク開始
タスクB タスク開始
タスクC タスク開始
タスクA タスク終了
タスクB タスク終了
タスクC タスク終了
```

!!! tips "tips 並列処理と並列処理の違い"
    並列処理：複数のCPUコアで物理的に同時に処理  
    並行処理：1つのCPUコアで行う処理を切り替える  

## 6-1-2 Pythonでの非同期処理

|イベントループ|
|----|
|プログラムが順番にタスクをこなすための仕組み|

<figure markdown="span">
  ![alt text](<../../../images/6.1 同期処理と非同期処理とは？/6.1 同期処理と非同期処理とは？_J0133291.png>){width=400}
  <figconfig>イベントループ</figconfig>
</figure>

## 6-1-3 「asyncio」を使用するプログラムの作成

下記のように非同期処理を行う関数を２つに分けて待ち時間を変更して実行する

```python title="main.py"
import asyncio

async def fetch_data():
    print("データ処理を開始します")
    await asyncio.sleep(4)
    print("データが取得されました")

async def perform_calculartion():
    print("計算を始めます")
    await asyncio.sleep(2)
    print("計算が完了しました")

async def main():
    print("データ取得と計算を開始する前")
    await asyncio.gather(fetch_data(), perform_calculartion())
    print("全てのタスクを完了しました")
    
asyncio.run(main())
```

実行結果を確認すると2つの処理が終了するのを待って、次の処理を行っていることが分かる

```bash title="実行結果"
データ取得と計算を開始する前
データ処理を開始します
計算を始めます
計算が完了しました
データが取得されました
全てのタスクを完了しました
```